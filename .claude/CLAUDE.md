# WebAuthn デモプロジェクトの目的

## プロジェクトのゴール

このプロジェクトは、**WebAuthnの本質を段階的に理解できる学習教材**を提供することを目指しています。

### プロジェクト構成

このリポジトリは、**フラットなモノレポ構造**を採用しています：

- **demo1-basic/** - WebAuthnの本質のみ（登録+認証）
- **demo2-management/** - 実用的な実装（セッション+一覧+削除+デバイス名）
- **demo3-mfa/** - 多要素認証パターン（未実装）

各デモは独立したSpring Bootプロジェクトで、Eclipseに個別にインポート可能です。

### 重視する価値観

1. **シンプルさ**
   - 不要な抽象化や過度な設計を排除
   - WebAuthnの核心部分に集中
   - 理解しやすく、学習しやすいコード

2. **ポータビリティ**
   - 実プロジェクトへの転用が容易
   - グローバルな設定に依存しない
   - WebAuthn固有の処理を局所化

3. **本質の理解**
   - WebAuthn仕様の理解が深まる実装
   - ライブラリの正しい使い方を示す
   - 動作する最小限のコード

4. **段階的な学習**
   - demo1で本質を理解
   - demo2で実用パターンを学ぶ
   - demo3で高度なパターンに進む

## demo1-basic の設計方針

### 含まれるもの
- ユーザー登録（Registration）
- 認証（Authentication）

### 含まれないもの
- セッション管理（アプリケーション層の機能）
- 認証器一覧表示（アプリケーション層の機能）
- 認証器削除（アプリケーション層の機能）
- デバイス名管理（アプリケーション層の機能）

### 目的
WebAuthn仕様で定義されているコア機能のみを実装し、本質的な仕組みを理解する。

## demo2-management の設計方針

### 含まれるもの
- ユーザー登録（Registration）
- 認証（Authentication）
- セッション管理
- 認証器一覧表示
- 認証器削除
- **デバイス名の設定・表示**
- 複数認証器の管理

### 目的
GoogleやGitHubなどの実サービスに近い実装を通じて、実用的なパターンを学ぶ。
WebAuthn仕様とアプリケーション層の責任分離を理解する。

### アプリケーション層の機能

以下はWebAuthn仕様には含まれないが、実用的なアプリケーションに必要な機能：

- **セッション管理**: 認証後のユーザー状態の保持
- **認証器のメタデータ管理**: デバイス名、登録日時など
- **認証器の一覧表示**: ユーザーが自分の認証器を確認
- **認証器の削除**: ユーザーが不要な認証器を削除

これらは `AuthenticatorInfo.nickname` のように、WebAuthnのコア機能とは明確に分離されています。

## 技術的な判断基準

### 採用した方針

- **YubicoライブラリのtoJson()を使用**
  - ライブラリが提供する正式な方法
  - グローバルなJackson設定不要
  - null値の処理が適切に行われる

- **必要最小限のファイル構成**
  - デバッグ用ファイルは削除
  - 不要な設定ファイルは削除
  - CORSなどの余計な設定は排除

- **フラットなモノレポ構造**
  - 親POMなし（各デモは完全に独立）
  - Eclipseプロジェクトとして個別にインポート可能
  - 学習の進行度に応じて選択可能

### 避けるべきこと

- グローバルなJackson設定（他のAPIに影響）
- WebAuthn以外にも影響する設定
- 過度な抽象化や汎用化
- デバッグコードの残存
- 親子関係のあるMaven構成（シンプルさを優先）

## 現在の構成

### バックエンド
- Spring Boot 3.5.7 + Java 21
- Yubico webauthn-server-core 2.5.2
- インメモリデータベース（デモ用）

### フロントエンド
- Vanilla JavaScript（ライブラリ不使用）
- WebAuthn API直接呼び出し
- Thymeleaf（サーバーサイドテンプレート）

## 今後の展開

このプロジェクトは継続的に改善し、以下を目指します：

1. **demo3-mfaの実装**
   - パスワード + WebAuthn
   - パスワードレスWebAuthn + バックアップパスワード

2. **さらなるシンプル化**
   - 本当に必要なコードだけを残す
   - 冗長な部分を削減

3. **理解の深化**
   - WebAuthnの各要素の役割を明確化
   - コメントで本質を説明

4. **転用性の向上**
   - 実プロジェクトへのコピー＆ペーストが容易
   - 依存関係を最小化

## ディレクトリ構造

```
/mnt/d/Application/pleiades/workspace/demo/
├── .git/                    # Gitリポジトリ
├── .claude/
│   └── CLAUDE.md           # このファイル
├── demo1-basic/            # WebAuthn本質のみ
│   ├── src/
│   ├── pom.xml
│   ├── .project
│   └── .classpath
├── demo2-management/       # 実用的な実装
│   ├── src/
│   ├── pom.xml
│   ├── .project
│   └── .classpath
├── demo3-mfa/              # 多要素認証（未実装）
└── README.md               # プロジェクト全体の説明
```

## コード修正時の指針

### demo1-basicへの変更
- WebAuthn仕様の本質に関わる変更のみ
- アプリケーション層の機能は追加しない
- 最小限・最もシンプルな実装を維持

### demo2-managementへの変更
- 実用的なアプリケーションに必要な機能
- WebAuthn仕様とアプリケーション層を明確に分離
- コメントで区別を明示

### 両方に共通する変更
- バグ修正
- コメントの改善
- セキュリティ向上
- ライブラリアップデート

### 変更を反映する流れ
1. demo1-basicで本質的な変更を加える
2. その変更をdemo2-managementにも反映
3. demo2-management固有の機能を追加
4. 両者の差分を明確に保つ
